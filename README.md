## Capstone-UCSD — Chatbot Filtration Service (Share/Presentation)

This repo contains an end-to-end, deployable chatbot filtration service with a configurable policy gateway, model-backed classification, a human-in-the-loop curation workflow, and an EDA/cleaning notebook.

### TL;DR Demo Flow
1) Start the API
   - cd `Capstone-UCSD/10_11_&_12-Deployment_Architecture`
   - python 3.9+ recommended
   - `python3 -m venv .venv && source .venv/bin/activate`
   - `pip install -r requirements.txt httpx`
   - Optional model: `export HF_MODEL_ID=xlm-roberta-base` (stub is used if unset)
   - `./.venv/bin/uvicorn app.main:app --host 127.0.0.1 --port 8000 --reload`

2) Try the web UIs
   - Config + test UI: `http://127.0.0.1:8000/ui`
   - Reviewer UI (table view + labeling): `http://127.0.0.1:8000/reviewer`

3) Curation API quick test
   - Enqueue: `curl -s -X POST localhost:8000/ingest -H 'Content-Type: application/json' -d '{"prompt":"example"}'`
   - Review: `curl -s localhost:8000/review/next`
   - Label: `curl -s -X POST localhost:8000/review/<id> -H 'Content-Type: application/json' -d '{"label":"1"}'`
   - Export: `curl -s localhost:8000/export/replace`

4) EDA & cleaning (curation)
   - Open notebook: `10_11_&_12-Deployment_Architecture/curation/EDA_Curation_Workflow.ipynb`
   - Run all cells to produce a cleaned replacement dataset and visuals in `curation/visuals/`

5) Optional downstream mock
   - Terminal 2: `uvicorn app.downstream_mock:app --host 127.0.0.1 --port 8001`
   - Then exercise `POST /gateway` from the UI or via curl.

### Visuals (generated by the notebook)
- `curation_overview.png`: label distribution, character lengths, word counts
- `trigrams_heatmap.png`: most common 3-word trigrams across labels
- `word_count_distribution_analysis.png`: word count box/whisker by label
- `words_heatmap_p1.png`, `words_heatmap_p2.png`, `words_heatmap_p3.png`: top 150 words (50/page), excluding stopwords

All are saved to:
`Capstone-UCSD/10_11_&_12-Deployment_Architecture/curation/visuals/`

### Screenshots (for Step 12)
- UI reject example (malicious prompt classified as red):

  ![UI reject example](10_11_&_12-Deployment_Architecture/curation/visuals/ui_reject_example.jpeg)

  Save your screenshot at the above path to display it here.

- Reviewer ready-to-classify view:

  ![Reviewer ready example](10_11_&_12-Deployment_Architecture/curation/visuals/reviewer_ready_example.jpeg)

  Save your screenshot at the above path to display it here.

### Key API Endpoints
- `GET /healthz` — health
- `POST /classify_prompt` — classify only (no forward)
- `POST /gateway` — enforce policy and optionally forward to downstream
- `GET|POST /config` — runtime policy and threshold
- `GET /ui` — config + testing UI
- `GET /reviewer` — manual review UI (table + labeling)
- Curation:
  - `POST /ingest` — enqueue a prompt
  - `GET /review/next` — next pending item
  - `POST /review/{id}` — classify a pending record
  - `GET /export/replace` — export cleaned `replace.json`

### Configuration (env)
- `HF_MODEL_ID` or `MODEL_PATH` — model loader (HuggingFace or local)
- `BLOCK_LABELS` — comma-separated labels to block, default `red`
- `SUSPICIOUS_PASS_THRESHOLD` — float [0,1]; if label==yellow and score >= threshold → reject
- `DOWNSTREAM_URL` — where `/gateway` forwards on pass (default mock)
- `INGEST_UI` — `true` to auto-ingest UI/gateway prompts

### Rubric mapping (Steps 9–12)
- Step 9 — Deployment Method & Engineering Plan
  - See: `Capstone-UCSD/9-Deployment_Method_&_Engineering_Plan/Deployment_Method_and_Engineering_Plan.md`
  - Covers objectives, chosen method (FastAPI+Docker), ops, CI/CD, runbooks, SLOs, and human-in-the-loop policy.
- Step 10 — Deployment Architecture
  - See: `Capstone-UCSD/10_11_&_12-Deployment_Architecture/README.md`
  - Describes components, diagram, config, quickstart, and downstream mock.
- Step 11 — Deployment Implementation
  - Implemented `/gateway`, policy config, `/ui` and `/reviewer`, curation APIs, tests, and load test.
- Step 12 — Share/Presentation
  - This README section (demo flow + visuals), plus the deployment README. Use the notebook to generate figures for slides.

### Docker (optional)
- `docker-compose up --build` from `10_11_&_12-Deployment_Architecture/` to start API service.

### Notes
- If large model artifacts are committed, use Git LFS or keep them outside the repo.
- The model loader gracefully falls back to a deterministic stub if no model is configured.

### External Docs
- Slides/Supporting doc: [Google Doc](https://docs.google.com/document/d/1XR2jrcj17HJbwI5lyBWgFgL517oNfUaZQqr605-QXXA/edit?tab=t.0)
- Step 10 – Deployment Architecture (Google Doc): [Link](https://docs.google.com/document/d/199UTvpOHjqiwnlPuibljDTAG5V9u6j6OfCBQuk_0fDw/edit?tab=t.0)
